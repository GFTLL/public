<!doctype html>
<html>
	<head>
		<meta charset="utf-8"/>
		<title>异步请求</title>
		<script type="text/javascript">
			//创建Ajax对象(XMLHttpRequest)
			function getXHR() {
				//根据对象判断浏览器
				if(XMLHttpRequest) {
					//不是IE
					return new XMLHttpRequest();
				} else {
					//IE
					return new ActiveXObject(
						"Microsoft.XMLHttp");
				}
			}
			//使用Ajax发送异步的get请求
			function f1(userName) {
				//1.获取Ajax对象
				var xhr = getXHR();
				//2.给这个对象的状态改变事件绑定
				//  函数，用来监测请求的进展。
				xhr.onreadystatechange = 
					function(){callback(xhr);};
				//3.创建请求
				var url = "hello?userName="+userName;
				//第3个参数是设置异步/同步请求，
				//若为true则是异步请求，请求时页面不暂停；
				//若为false则是同步请求，请求时页面暂停；
				xhr.open("get",url,true);
				//4.发送请求
				xhr.send(null);
			}
			//回调函数：请求发出后，状态改变时
			//Ajax自动调用的函数。
			function callback(xhr) {
				//响应结束且服务端没报错
				if(xhr.readyState==4 && xhr.status==200) {
					//获取响应的文本内容
					alert(xhr.responseText);
				}
			}
			//使用Ajax发送post请求
			function f2(userName) {
				var xhr = getXHR();
				xhr.onreadystatechange = 
					function(){callback(xhr)};
				xhr.open("post","hello",true);
				//post请求的消息头中需要指定数据格式，
				//但Ajax默认并没有指定，需手动指定。
				xhr.setRequestHeader("content-type",
					"application/x-www-form-urlencoded");
				xhr.send("userName="+userName);
			}
		</script>
	</head>
	<body>
		<button onclick="f1('SAN');">GET</button>
		<button onclick="f2('里斯');">POST</button>
		<p><input type="text"/></p>
	</body>
</html>





